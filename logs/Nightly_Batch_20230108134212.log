2023-01-08 13:42:12.728032: Nightly Batch Started
2023-01-08 13:42:12.728096: Starting the Extraction Process
2023-01-08 13:42:12.937623: query executed: 
                    SELECT * FROM RETAIL_DWH.SOURCE.COUNTRY
            
2023-01-08 13:42:12.937623: Loading to Sales 2023-01-08 13:42:12.937623
2023-01-08 13:42:13.196273: query executed: TRUNCATE TABLE RETAIL_DWH.TEMP.TMP_SALES
2023-01-08 13:42:13.196273: Successfully truncated TEMP.TMP_SALES
2023-01-08 13:42:14.371934: query executed: 
    INSERT INTO RETAIL_DWH.TEMP.TMP_SALES(
        SLS_ID,
        STORE_KY,
        DT_KY,
        PDT_KY,
        CUSTOMER_KY,
        TRANSACTION_TIME,
        QTY,
        AMT,
        DSCNT
    )
    SELECT
    SLS.ID,
    LOC.LOCN_KY,
    DT.DAY_KY,
    ITM.PDT_KY,
    CUST.CUSTOMER_KY,
    TRANSACTION_TIME,
    QUANTITY,
    AMOUNT,
    DISCOUNT
    FROM RETAIL_DWH.STAGE.STG_SALES as SLS
    LEFT OUTER JOIN RETAIL_DWH.TARGET.D_RETAIL_LOCN_T LOC
    ON SLS.STORE_ID = LOC.LOCN_ID
    LEFT OUTER JOIN RETAIL_DWH.TARGET.D_RETAIL_PDT_T ITM
    ON SLS.PRODUCT_ID = ITM.PDT_ID
    LEFT OUTER JOIN RETAIL_DWH.TARGET.D_RETAIL_TIME_DAY_T DT
    ON TO_DATE(SLS.TRANSACTION_TIME) = DT.ID
    LEFT OUTER JOIN RETAIL_DWH.TARGET.D_RETAIL_CUSTOMER_T CUST
    ON CUST.CUSTOMER_ID = SLS.CUSTOMER_ID;
2023-01-08 13:42:14.374334: Successfully loaded to temp table SALES
2023-01-08 13:42:14.899878: query executed:  UPDATE RETAIL_DWH.TARGET.F_RETAIL_SLS_T AS T1
                                          SET T1.LOCN_KY = T2.STORE_KY ,
                                          T1.PDT_KY = T2.PDT_KY,
                                          T1.CUSTOMER_KY = T2.CUSTOMER_KY,
                                          T1.QTY = T1.QTY+T2.QTY ,
                                          T1.AMT = T1.AMT+T2.AMT ,
                                          T1.DSCNT = T1.DSCNT+T2.DSCNT,   
                                          ROW_UPDT_TMS = LOCALTIMESTAMP 
                                          FROM RETAIL_DWH.TEMP.TMP_SALES AS T2
                                          WHERE T1.SLS_ID = T2.SLS_ID;
                  
2023-01-08 13:42:14.899878: Successfully loaded to target table F_RETAIL_SLS_T
2023-01-08 13:42:15.316157: query executed: INSERT INTO RETAIL_DWH.TARGET.F_RETAIL_SLS_T(
                SLS_ID,
                LOCN_KY,
                DT_KY,
                PDT_KY,
                CUSTOMER_KY,
                TRANSACTION_TIME,
                QTY,
                AMT,
                DSCNT,
                OPEN_CLOSE_CD,
                ROW_INSRT_TMS,
                ROW_UPDT_TMS
               
            ) 
            SELECT
                SLS_ID,
                STORE_KY,
                DT_KY,
                PDT_KY,
                CUSTOMER_KY,
                TRANSACTION_TIME,
                QTY,
                AMT,
                DSCNT,
                1,
                LOCALTIMESTAMP,
                LOCALTIMESTAMP
            FROM RETAIL_DWH.TEMP.TMP_SALES
            WHERE SLS_ID NOT IN (SELECT DISTINCT(SLS_ID) FROM RETAIL_DWH.TARGET.F_RETAIL_SLS_T);


2023-01-08 13:42:15.316157: Successfully loaded to target table F_RETAIL_SLS_T
2023-01-08 13:42:15.316157: Loaded to Sales 2023-01-08 13:42:15.316157
